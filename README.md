# Инструкция по использованию программного продукта AngryCritic

AngryCritic - инструмент для анализа данных и определения их тональности, на основании заданных параметров и ключевых слов.
## Компоненты программы
- **angrycritic.py** – исполняемый файл;
- **Папка data** – содержит конфигурационные файлы в формате yaml, для настройки работы кода под ваш контекст данных.
	+ **sample.yaml** - образец со структурой для создания конфигурационных файлов под новые типы данных;
	+ **types.yaml** - содержит ключевые слова для определения типа (категории) данных;
	+ **skip.yaml** – массив ключевых слов и словосочетаний, при обнаружении которых обработка данных производиться не будет;
	+ **replace.yaml** – на стадии предобработке текста имеется возможность произвести замену ключевых слов или фраз и внести эти данные в словари различных типов данных, для однозначного и верного определения категории данных;
	+ **mood_keywords_otp.yaml и mood_keywords_fishing.yaml** и т.д. - конфигурационные файлы, содержащие ключевые слова для конкретных категорий данных.


## Список пакетов, необходимых для работы программы
Перед запуском убедитесь, что все необходимые пакеты установлены:
- **yaml**;
- **os**;
- **pandas**;
- **pymorph3**;
- **string**;
- **time**;
- **tqdm**;
- **nltk**.
Или воспользоватесь командой:
> pip install -r requirements.txt

## Запуск программы
Перед запуском программы, Excel-файл с данными необходимо переименовать в «**data.xlsx**» и поместить в корневой каталог с программой. Данные, по которым необходимо провести анализ, должны находиться в столбце «**А**». По окончанию обработки в данной папке будет создан файл «**data_done.xlsx**». В обработанном файле будут добавлены следующие данные:
- Леммы слов;
- Категория, к которой относятся данные;
- Ключевые слова, на основании которых была определена категория;
- Тональность;
- Ключевые слова, на основании которых была определена тональность;
- Значение index, на основании которого определяется тональность данных (Больше 0 – позитив, меньше 0 – негатив).;
	> Если в анализируемом тексте встречается несколько ключевых слов, то на основании значения их тональности вычисляется значение index (positive +1, negative -1, undef = 0).
- Вкладка с частотой упоминания слов в документе, для помощи в проработке ключей в **types.yaml** для определения категории(типа) данных;
- Вкладки с частотой упоминания слов для каждой категории данных, заданных в файле **types.yaml**.

## Скорость обработки
На ПК с процессором Intel(R) Core(TM) i5-11400, 8Gb RAM - 4000 строк/мин

## Как настроить программу под свои данные
Первичный запуск:
Поместите «**data.xlsx**» в корневой каталог, запустите процесс обработки. По окончанию откройте файл «**data_done.xlsx**», на вкладке **Частотка по документу** будет представлен список слов с частотой их употребления в документе. Проанализируйте данную информацию, выделите основные категории данных в документе и внесите характеризующие их ключи в файл **types.yaml**. Сохраните изменения в файле **types.yaml**.

Запустите повторное выполнение кода, предварительно закрыв файл «**data_done.xlsx**».
В новом документе появятся дополнительные вкладки с названием заданных категорий(типов) в файле **types.yaml**. На вкладках будет содержаться список слов с частотой их употребления в тексте указанной категории(типа) данных. Воспользуйтесь данной информацией для формирования файлов с ключевыми словами для определения тональности - **mood_keywords_xxx.yaml**.

## Подробнее о работе кода
Обработка документа выполняется в 2 этапа:
1. Предварительная обработка - определение типов/категорий информации в данных, пометка данных, которые обрабатываться не будут, замена ключевых слов.
	- В файл **skip.yaml** - добавьте ключи, при обнаружении которых обработка данных производиться не будет (очистка от спама);
	- В файл **types.yaml** следует добавить типа/категории данных и ключевые слова для определния. Важно! название типа/категории должно соответсвовать названию его конфигурационного файла. Например, otp - mood_keywords_otp.yaml.
	 Если однозначно определить категорию по ключевому слову не представляется возможным, то необходимо добавить ключи в категорию **undef**. То есть, будет проводиться дополнительный анализ данных, по ключевым словам, из словаря **presence_kw** и на основании их наличия будет определяться категория данных.
	 Как это работает:
		> Например, ваши данные содержат слово «письмо», по которому определить к какой категории их отнести достаточно трудно. Поэтому в мы его добавляем в словарь 'undef'. Теперь, если в ваших данных содержится слово ‘письмо’ обработчик будет искать наличие других ключевых слов из словаря presence_kw и на основании их наличия будет определять категорию данных. Если ему это не удастся, данные будут помечены как нераспознанные - ‘undef’.
	- Файл **replace.yaml** – на стадии предобработке текста имеется возможность произвести замену ключевых слов или фраз и внести эти данные в словари различных типов данных, для однозначного и верного определения категории данных. Кроме того, с помощью замены можно исключить, данные не имеющие значения, но часто встречающиеся и влияющие на результат (Например, фраза “Отправлено с iPhone”);
			```
			general:
				отправить с ipad:
				отправить с iphone:
				не согласен: не_согласен
				не согласна: не_согласен
			fishing:
				мочь подтвердить: могу_подтвердить
			```
			- general, fishing – категории данных, к которым будут применены правила замены;
			- general – общие правила замены для всех категорий;
			- отправить с ipad – слово или фраза, которую необходимо заменить (если требуется какую-то фразу убрать из текста, после : осталяйте пустое место, как в данном случае);
			- не_согласен – слово или фраза, на что требуется заменить. Заменяйте пробелы на _ для получения единых словосочетаний, которые в последствии можно будет добавить в ключевые слова для определения тональности.
2. Определение тональности исходя из конфигурационных файлов с ключевыми словами.
	Конфигурационные файлы типов/категорий **mood_keywords_otp.yaml и mood_keywords_fishing.yaml** - необходимо заполнить ключевыми словами, дл определения тональности конкретной категории, или создать новый файл под новую категорию.

Тональность может принимать следующие значения:
| Наименование     | Описание                                                      |
|------------------|---------------------------------------------------------------|
| positive	  | при наличии данного слова в тексте тональность положительная |
| negative        | при наличии данного слова в тексте тональность отрицательная |
| near_positive  | при наличии данного ключа в тексте и сопутствующих слов из словаря near перед ключевым в пределах 2 позиций - тональность положительная |
| near_negative   | при наличии данного ключа в тексте и сопутствующих слов из словаря near перед ключевым в пределах 2 позиций - тональность отрицательная |
| presence	   | при наличии данного ключа в тексте, сопутствующих слов из словаря near перед ключевым в пределах 2 позиций, а также при наличии вспомогательных слов из словаря presence - тональность будет определяться исходя из значения ключей presence |

Вспомогательные ключевые слова, которые располагаются в пределах двух позиций перед основным ключевым словом
	+ **near_kw** – в словаре содержится данные о категории и список сопутствующих слов, при наличии или отсутствии которых принимается решении о тональности данных
		> Например, возьмем fishing.yaml, в словаре 'near' в разделе 'negative' имеется слово - «пропустить». Если в данных будет фраза «не пропустить», то указанное выражение будет считаться негативным.
	+ **presence_kw** – словарь содержит ключевые слова, которые будут определять тональность только совместно с near.
		> Например, возьмем fishing.yaml, в словаре 'presence_kw' имеется слово - «удалить». 
		Возьмем условную фразу "Пришло подозрительное письмо, я его удалила". Здесь нам встречается слово "удалить", после чего определяется, есть ли с ним сопуствующая частица или слово из near_kw. В данном случае имеется, далее происходит проверка на наличие слов из словаря presence, на основании которых принимается решении о тональности.
